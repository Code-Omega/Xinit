{% extends "base.html" %}
{% block content %}
<button type="button" class="btn btn-dark btn-sm shadow-lg sidebar_toggle" data-toggle="toggle-sidebar">
  <a href="#" data-toggle="tooltip" title="Toggle Sidebar" data-placement="left" class="text-white">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11 shadow-lg" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg="">
      <path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z">
      </path>
    </svg>
  </a>
</button>

<div class="container-fluid">
  <div class="row">
    <div class="main col sided">
      {% for post in posts %}
        <div class="card mb-3">
          <div class="card-header text-white bg-dark">
            <div class = "row">
              <h3 class = "col">{{ post.title }}</h3>
              <button type="button" class="col col-auto card-control btn btn-info bg-theme-highlight mr-3" data-toggle="button" aria-pressed="false" autocomplete="off">
                <b>Read more</b>
              </button>
            </div>
          </div>
          <div class="card-body card-abstract">
            {{ post.abstract |safe }}
          </div>
          <div class="card-body card-text" style="display: none;">
            {{ post.content |safe }}
          </div>
          <div class="card-footer text-white bg-dark text-center small p-1">
            <div class="row">
              <div class="col col-2">
                By
              </div>
              <div class="col col-4">
                At
              </div>
              <div class="col col-3">
                Keywords
              </div>
              <div class="col col-3">
                Related Assets
              </div>
            </div>
            <hr class="m-1">
            <div class="row">
              <div class="col col-2">
                {{ post.author }}
              </div>
              <div class="col col-4">
                {{ post.time_added.strftime("%Y-%m-%d %H:%M:%S") }}
                {# TODO: Change to dynamic time #}
              </div>
              <div class="col col-3">
                {{ post.keywords }}
              </div>
              <div class="col col-3">
                {{ post.key_assets }}
              </div>
            </div>
            {% if session.username == post.author %}
              <a class="btn btn-dark btn-block bg-dark font-weight-bold" href="{{ url_for('update_post', id=post['_id']) }}">Edit</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="sidebar in col-sm-auto inset">
      <div class="sidebar_chart shadow">
        <div class="tradingview-widget-container frame">
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
            {{iframe_src|safe}}
          </script>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  $(document).ready(function() {
    checkSize();
    // setTimeout(unprohibit_animation(),10000);
    // $(window).resize(checkSize);
  });
  function checkSize() {
    if ($(".main.sided").css("margin-left") == "-400px" ){
      $('.sidebar').toggleClass('in');
      $('.main').toggleClass('sided');
      $('.sidebar_toggle').children().children().toggleClass('out');
      $(window).on('load', function() {
        unprohibit_animation();
      });
    } else {
      unprohibit_animation();
    }
  }
  function unprohibit_animation(){
    $('.sidebar').toggleClass('loaded');
    $('.main').toggleClass('loaded');
  }
  $("[data-toggle='toggle-sidebar']").click(function() {
    $('.sidebar').toggleClass('in');
    $('.main').toggleClass('sided');
    $('.sidebar_toggle').children().children().toggleClass('out');
  });
  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })

  $(document).on('click', '.card-control', function() {
    $(this).parent().parent().parent().find('.card-text').toggle(600);
    $(this).parent().parent().parent().find('.card-abstract').toggle(600);
  });
</script>
{% endblock script %}
